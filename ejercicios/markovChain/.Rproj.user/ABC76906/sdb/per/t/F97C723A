{
    "collab_server" : "",
    "contents" : "### ----- REGRESION AVANZADA ----- ###\n# --- Prof. Luis E. Nieto Barajas --- #\n\n\n#--- Usar espejo CRAN del ITAM ---\noptions(repos=\"cran.itam.mx\")\n\n#--- Funciones utiles ---\nprob<-function(x){\n  out<-min(length(x[x>0])/length(x),length(x[x<0])/length(x))\n  out\n}\n\n#--- Ilustracion del proceso de inferencia ---\n\n#-Proceso de aprendizaje normal-normal-\nxbar<-40.9533\nsig2<-10\nn<-100#30#3\n\nth0<-39\nsig20<-1#219.47\n\ny<-seq(35,45,,200)\nf0y<-dnorm(y,th0,sqrt(sig20))\nliky<-dnorm(y,xbar,sqrt(sig2/n))\nsig21<-1/(n/sig2+1/sig20)\nth1<-sig21*(n/sig2*xbar+th0/sig20)\nf1y<-dnorm(y,th1,sqrt(sig21))\nymax<-max(f0y,liky,f1y)\nplot(y,f0y,ylim=c(0,ymax),type=\"l\")\nlines(y,liky,lty=2,col=2)\nlines(y,f1y,lty=3,col=3)\n\n#-Proceso de aprendizaje bernoulli-beta-\n\n#Simulacion de datos Bernoulli\ntheta0 <- 0.6\nn <- 10\nx<-rbinom(n,1,theta0)\nhist(x,freq=FALSE)\n\n#Distribucion inicial para theta\na <- 1\nb <- 1\ntheta<-seq(0,1,,100)\nplot(theta,dbeta(theta,a,b),type=\"l\")\n\n#Distribucion final\na1 <- a + sum(x)\nb1 <- b + n - sum(x)\nplot(theta,dbeta(theta,a1,b1),type=\"l\")\n\n#Ambas\ntheta<-seq(0,1,,100)\nymax <- max(dbeta(theta,a,b),dbeta(theta,a1,b1))\nplot(theta,dbeta(theta,a,b),type=\"l\",ylim=c(0,ymax))\nlines(theta,dbeta(theta,a1,b1),col=2)\nabline(v=theta0,col=4)\n\n#Aproximacion normal asintotica\nmu <- (a1-1)/(a1+b1-2)\nsig2 <- (a1-1)*(b1-1)/(a1+b1-2)^3\nlines(theta,dnorm(theta,mu,sqrt(sig2)),col=3)\n\n\n# --- Aproximaciï¿½n Monte Carlo --- \n#-Ejemplo 1-\nx<-seq(-2,4,,100)\nf<-function(x){\n  out <- 5-(x-1)^2\n  out <- ifelse (x < -1 | x>3,0,out)\n  out\n}\nplot(x,f(x)*3/44,type=\"l\",ylim=c(0,0.5))\nlines(x,dnorm(x,0,1),lty=2,col=2)\nlines(x,dnorm(x,1,2/3),lty=3,col=3)\nlines(x,dnorm(x,1,1),lty=4,col=4)\n\n#Caso 1: S=Normal estandar\nmu<-0\nsig<-1\nN<-100000\ny<-rnorm(N,mu,sig)\nI1<-mean(f(y)/dnorm(y,mu,sig))\neI1<-sd(f(y)/dnorm(y,0,1))/sqrt(N)\nprint(c(I1,eI1))\n\n#Caso 2: S=Normal no estandar\nmu<-1\nsig<-2/3\nN<-100000\ny<-rnorm(N,mu,sig)\nI2<-mean(f(y)/dnorm(y,mu,sig))\neI2<-sd(f(y)/dnorm(y,mu,sig))/sqrt(N)\nprint(c(I2,eI2))\n\n#Caso 3: S=Normal no estandar\nmu<-1\nsig<-1\nN<-100000\ny<-rnorm(N,mu,sig)\nI3<-mean(f(y)/dnorm(y,mu,sig))\neI3<-sd(f(y)/dnorm(y,mu,sig))/sqrt(N)\nprint(c(I3,eI3))\n\n#-Ejemplo 2-\nf<-function(x){\n  out<-ifelse(x<0,0,x)\n  out<-ifelse(x>1,0,out)\n  out\n}\n\nx<-seq(-1,2,,100)\nplot(x,f(x),type=\"l\",ylim=c(0,1.2))\n\nN<-10000\n\n#Caso 1: S=Uniforme\nlines(x,dunif(x,0,1),col=2,lty=2)\ny<-runif(N,0,1)\nI1<-mean(f(y)/dunif(y,0,1))\neI1<-sd(f(y)/dunif(y,0,1))/sqrt(N)\nprint(c(I1,eI1))\n\n#Caso 2: S=Exponencial\nlines(x,dexp(x,1),col=3,lty=3)\ny<-rexp(N,1)\nI2<-mean(f(y)/dexp(y,1))\neI2<-sd(f(y)/dexp(y,1))/sqrt(N)\nprint(c(I2,eI2))\n\n#Caso 3: S=Normal\nlines(x,dnorm(x,0.5,1/3),col=4,lty=4)\ny<-rnorm(N,0.5,1/3)\nI3<-mean(f(y)/dnorm(y,0.5,1/3))\neI3<-sd(f(y)/dnorm(y,0.5,1/3))/sqrt(N)\nprint(c(I3,eI3))\n\n\n#-Muestreador de Gibbs-\ninstall.packages(\"bayesm\")\nlibrary(bayesm)\nout<-rbiNormGibbs(rho=.95)\nout<-rbiNormGibbs(rho=-0.5)\n\n\n###########################################\n\ninstall.packages(\"R2OpenBUGS\")\ninstall.packages(\"R2jags\")\nlibrary(R2OpenBUGS)\nlibrary(R2jags)\n\n#-Working directory-\n#wdir<-\"c:/Temp/\"\n#setwd(wdir)\n\n\n#--- Ejemplo 1---\n#-Reading data-\nn<-100\ncredito<-c(rep(1,n/2),rep(0,n/2))\n\n#-Defining data-\ndata<-list(\"n\"=n,\"x\"=credito)\n\n#-Defining inits-\ninits<-function(){list(theta=0.5,x1=rep(1,2))}\ninits<-function(){list(lambda=0)}\n#inits<-function(){list(theta=0.5,eta=1)}\n\n#-Selecting parameters to monitor-\nparameters<-c(\"theta\",\"x1\")\n#parameters<-c(\"theta\",\"eta\")\n\n#-Running code-\n#OpenBUGS\nej1.sim<-bugs(data,inits,parameters,model.file=\"Ej1.txt\",\n              n.iter=5000,n.chains=1,n.burnin=500)\n#JAGS\nej1.sim<-jags(data,inits,parameters,model.file=\"Ej1.txt\",\n              n.iter=5000,n.chains=1,n.burnin=500)\n\n#-Monitoring chain-\n\n#Traza de la cadena\ntraceplot(ej1.sim)\n\n#Cadena\n\n#OpenBUGS\nout<-ej1.sim$sims.list\n\n#JAGS\nout<-ej1.sim$BUGSoutput$sims.list\n\nz<-out$x1\npar(mfrow=c(2,2))\nplot(z,type=\"l\")\nplot(cumsum(z)/(1:length(z)),type=\"l\")\nhist(z,freq=FALSE)\nacf(z)\n\n#Resumen (estimadores)\n#OpenBUGS\nout.sum<-ej1.sim$summary\n\n#JAGS\nout.sum<-ej1.sim$BUGSoutput$summary\n\nprint(out.sum)\n\n#DIC\n#OpenBUGS\nout.dic<-ej1.sim$DIC\n\n#JAGS\nout.dic<-ej1.sim$BUGSoutput$DIC\n\nprint(out.dic)\n\n#---------------------#\n#Mezcla de betas\nw<-seq(0.01,0.99,,100)\npp<-0.3\nfw<-pp*dbeta(w,10,10)+(1-pp)*dbeta(w,6,0.01)\npar(mfrow=c(1,1))\nplot(w,fw,type=\"l\")\n\n\n#--- Ejemplo 2---\n#-Reading data-\nutilidad<-c(212, 207, 210,\n            196, 223, 193,\n            196, 210, 202, 221)\nn<-length(utilidad)\n\n#-Defining data-\ndata<-list(\"n\"=n,\"x\"=utilidad)\n\n#-Defining inits-\ninits<-function(){list(mu=0,sig=1,x1=0)}\n\n#-Selecting parameters to monitor-\nparameters<-c(\"mu\",\"sig\",\"x1\")\n\n#-Running code-\n#OpenBUGS\nej2.sim<-bugs(data,inits,parameters,model.file=\"Ej2.txt\",\n              n.iter=5000,n.chains=1,n.burnin=500)\n#JAGS\nej2.sim<-jags(data,inits,parameters,model.file=\"Ej2.txt\",\n              n.iter=5000,n.chains=1,n.burnin=500)\n\n#-Monitoring chain-\n\n#Traza de la cadena\ntraceplot(ej2.sim)\n\n#Cadena\n\n#OpenBUGS\nout<-ej2.sim$sims.list\n\n#JAGS\nout<-ej2.sim$BUGSoutput$sims.list\n\nz<-out$x1\npar(mfrow=c(2,2))\nplot(z,type=\"l\")\nplot(cumsum(z)/(1:length(z)),type=\"l\")\nhist(z,freq=FALSE)\nacf(z)\n\n#Resumen (estimadores)\n#OpenBUGS\nout.sum<-ej2.sim$summary\n\n#JAGS\nout.sum<-ej2.sim$BUGSoutput$summary\n\nprint(out.sum)\n\n#DIC\n#OpenBUGS\nout.dic<-ej2.sim$DIC\n\n#JAGS\nout.dic<-ej2.sim$BUGSoutput$DIC\n\nprint(out.dic)\n\n\n#--- Ejemplo 3 ---\n#-Reading data-\ncalif<-read.table(\"http://allman.rhon.itam.mx/~lnieto/index_archivos/calificaciones.txt\",header=TRUE)\nn<-nrow(calif)\nplot(calif)\n\n#-Defining data-\ndata<-list(\"n\"=n,\"y\"=calif$SP,\"x\"=calif$MO)\n\n#-Defining inits-\ninits<-function(){list(beta=rep(0,2),tau=1,yf=rep(0,n))}\n\n#-Selecting parameters to monitor-\nparameters<-c(\"beta\",\"tau\",\"yf\")\n\n#-Running code-\n#OpenBUGS\nej3.sim<-bugs(data,inits,parameters,model.file=\"Ej3_exp.txt\",\n              n.iter=1000000,n.chains=1,n.burnin=10000)\n#JAGS\nej3.sim<-jags(data,inits,parameters,model.file=\"Ej3.txt\",\n              n.iter=10000,n.chains=1,n.burnin=1000)\n\n#-Monitoring chain-\n\n#Traza de la cadena\ntraceplot(ej3.sim)\ndev.off()\n#Cadena\n\n#OpenBUGS\nout<-ej3.sim$sims.list\n\n#JAGS\nout<-ej3.sim$BUGSoutput$sims.list\n\nz<-out$beta[,2]\npar(mfrow=c(2,2))\nplot(z,type=\"l\")\nplot(cumsum(z)/(1:length(z)),type=\"l\")\nhist(z,freq=FALSE)\nacf(z)\n\n\nz<-out$beta[,1]\npar(mfrow=c(2,2))\nplot(z,type=\"l\")\nplot(cumsum(z)/(1:length(z)),type=\"l\")\nhist(z,freq=FALSE)\nacf(z)\n\nz<-out$beta\npar(mfrow=c(1,1))\nplot(z)\n#Resumen (estimadores)\n#OpenBUGS\nout.sum<-ej3.sim$summary\n\n#JAGS\nout.sum<-ej3.sim$BUGSoutput$summary\n\nprint(out.sum)\nhead(out.sum)\n\n#Probabilidades\nz<-out$beta[,1]\nprob(z)\n\n#DIC\nout.dic<-ej3.sim$DIC\nout.dic<-ej3.sim$BUGSoutput$DIC\nprint(out.dic)\n\n#Predictions\nout.yf<-out.sum[grep(\"yf\",rownames(out.sum)),]\nor<-order(calif$MO)\nymin<-min(calif$SP,out.yf[,c(1,3,7)])\nymax<-max(calif$SP,out.yf[,c(1,3,7)])\npar(mfrow=c(1,1))\nplot(calif$MO,calif$SP,ylim=c(ymin,ymax))\nlines(calif$MO[or],out.yf[or,1],lwd=2,col=4)\nlines(calif$MO[or],out.yf[or,3],lty=2,col=4)\nlines(calif$MO[or],out.yf[or,7],lty=2,col=4)\n\n\n#--- Ejemplo 4 ---\n#TAREA\n\n\n#--- Ejemplo 5 ---\n#-Reading data-\nmortality<-read.table(\"http://allman.rhon.itam.mx/~lnieto/index_archivos/mortality.txt\",header=TRUE)\nn<-nrow(mortality)\nplot(mortality)\nm<-1\nnef<-c(100)\nxf<-c(200)\n\n#-Defining data-\ndata<-list(\"n\"=n,\"ne\"=mortality$n,\"y\"=mortality$y,\"x\"=mortality$x,\"m\"=m,\"nef\"=nef,\"xf\"=xf)\n\n#-Defining inits-\ninits<-function(){list(beta=rep(0,2),yf1=rep(1,n),yf2=1)}\n\n#-Selecting parameters to monitor-\nparameters<-c(\"beta\",\"yf1\",\"yf2\")\n\n#-Running code-\n#OpenBUGS\nej5a.sim<-bugs(data,inits,parameters,model.file=\"Ej5a.txt\",\n               n.iter=50000,n.chains=1,n.burnin=5000)\nej5b.sim<-bugs(data,inits,parameters,model.file=\"Ej5b.txt\",\n               n.iter=50000,n.chains=1,n.burnin=5000)\nej5c.sim<-bugs(data,inits,parameters,model.file=\"Ej5c.txt\",\n               n.iter=50000,n.chains=1,n.burnin=5000,debug=TRUE)\n#JAGS\nej5a.sim<-jags(data,inits,parameters,model.file=\"Ej5a.txt\",\n               n.iter=50000,n.chains=1,n.burnin=5000)\nej5b.sim<-jags(data,inits,parameters,model.file=\"Ej5b.txt\",\n               n.iter=50000,n.chains=1,n.burnin=5000)\nej5c.sim<-jags(data,inits,parameters,model.file=\"Ej5c.txt\",\n               n.iter=50000,n.chains=1,n.burnin=5000)\n\n#-Monitoring chain-\n\n#Traza de la cadena\ntraceplot(ej5.sim)\n\n#Cadena\n\n#OpenBUGS\nout<-ej5.sim$sims.list\n\n#JAGS\nout<-ej5.sim$BUGSoutput$sims.list\n\nz<-out$beta[,2]\npar(mfrow=c(2,2))\nplot(z,type=\"l\")\nplot(cumsum(z)/(1:length(z)),type=\"l\")\nhist(z,freq=FALSE)\nacf(z)\n\n#Resumen (estimadores)\n#OpenBUGS\nout.sum<-ej5c.sim$summary\n\n#JAGS\nout.sum<-ej5.sim$BUGSoutput$summary\n\nprint(out.sum)\nhead(out.sum)\n\n#Probabilidades\nz<-out$beta[,1]\nprob(z)\n\n#DIC\nout.dic<-ej5c.sim$DIC\nout.dic<-ej5.sim$BUGSoutput$DIC\nprint(out.dic)\n\n#Predictions\nout.yf<-out.sum[grep(\"yf1\",rownames(out.sum)),]\nor<-order(mortality$x)\nymin<-min(mortality$y,out.yf[,c(1,3,7)])\nymax<-max(mortality$y,out.yf[,c(1,3,7)])\n\npar(mfrow=c(1,1))\nplot(mortality$x,mortality$y,ylim=c(ymin,ymax))\n#Modelo 1\nlines(mortality$x[or],out.yf[or,1],lwd=2,col=2)\nlines(mortality$x[or],out.yf[or,3],lty=2,col=2)\nlines(mortality$x[or],out.yf[or,7],lty=2,col=2)\n#Modelo 2\nlines(mortality$x[or],out.yf[or,1],lwd=2,col=3)\nlines(mortality$x[or],out.yf[or,3],lty=2,col=3)\nlines(mortality$x[or],out.yf[or,7],lty=2,col=3)\n\nplot(mortality$y,out.yf[,1])\nabline(a=0,b=1)\ncor(mortality$y,out.yf[,1])\n\n\n#--- Ejemplo 6 ---\n#-Reading data-\ndesastres<-read.table(\"http://allman.rhon.itam.mx/~lnieto/index_archivos/desastres.txt\",header=TRUE)\nn<-nrow(desastres)\nplot(desastres,type=\"l\")\nplot(desastres[2:n,2]-desastres[1:(n-1),2],type=\"l\")\nplot(log(desastres[2:n,2])-log(desastres[1:(n-1),2]),type=\"l\")\n\n\n#-Defining data-\ndata<-list(\"n\"=n,\"y\"=desastres$No.Desastres,\"x\"=desastres$Anho)\n\n#-Defining inits-\ninits<-function(){list(beta=rep(0,2),yf1=rep(1,n))}\n#inits<-function(){list(beta=rep(0,2),aux=1,aux2=1,yf1=rep(1,n))}\ninits<-function(){list(beta=rep(0,n),tau.b=1,yf1=rep(1,n))}\n\n#-Selecting parameters to monitor-\nparameters<-c(\"beta\",\"yf1\",\"mu\")\n#parameters<-c(\"beta\",\"r\",\"tau\",\"yf1\",\"mu\")\n\n#-Running code-\n#OpenBUGS\nej6a.sim<-bugs(data,inits,parameters,model.file=\"Ej6a.txt\",\n               n.iter=50000,n.chains=1,n.burnin=5000)\nej6b.sim<-bugs(data,inits,parameters,model.file=\"Ej6b.txt\",\n               n.iter=50000,n.chains=1,n.burnin=5000)\nej6c.sim<-bugs(data,inits,parameters,model.file=\"Ej6c.txt\",\n               n.iter=5000,n.chains=1,n.burnin=500)\n#JAGS\nej6a.sim<-jags(data,inits,parameters,model.file=\"Ej6a.txt\",\n               n.iter=50000,n.chains=1,n.burnin=5000)\nej6b.sim<-jags(data,inits,parameters,model.file=\"Ej6b.txt\",\n               n.iter=50000,n.chains=1,n.burnin=5000)\nej6c.sim<-jags(data,inits,parameters,model.file=\"Ej6c.txt\",\n               n.iter=5000,n.chains=1,n.burnin=500)\n\n#-Monitoring chain-\n\n#Traza de la cadena\ntraceplot(ej6.sim)\n\n#Cadena\n\n#OpenBUGS\nout<-ej6b.sim$sims.list\n\n#JAGS\nout<-ej6a.sim$BUGSoutput$sims.list\n\nz<-out$tau\npar(mfrow=c(2,2))\nplot(z,type=\"l\")\nplot(cumsum(z)/(1:length(z)),type=\"l\")\nhist(z,freq=FALSE)\nacf(z)\n\n#Resumen (estimadores)\n#OpenBUGS\nout.sum<-ej6a.sim$summary\n\n#JAGS\nout.sum<-ej6a.sim$BUGSoutput$summary\n\nprint(out.sum)\nhead(out.sum)\n\n#Probabilidades\nz<-out$beta[,1]\nprob(z)\n\n#DIC\nout.dic<-ej6a.sim$DIC\nout.dic<-ej6a.sim$BUGSoutput$DIC\nprint(out.dic)\n\n#Predictions\nout.yf<-out.sum[grep(\"yf1\",rownames(out.sum)),]\nymin<-min(desastres[,2],out.yf[,c(1,3,7)])\nymax<-max(desastres[,2],out.yf[,c(1,3,7)])\n\npar(mfrow=c(1,1))\nplot(desastres,type=\"l\",col=\"grey80\",ylim=c(ymin,ymax))\nlines(desastres[,1],out.yf[,1],lwd=2,col=2)\nlines(desastres[,1],out.yf[,3],lty=2,col=2)\nlines(desastres[,1],out.yf[,7],lty=2,col=2)\n\n#Medias\nout.mu<-out.sum[grep(\"mu\",rownames(out.sum)),]\npar(mfrow=c(1,1))\nplot(desastres,type=\"l\",col=\"grey80\")\nlines(desastres[,1],out.mu[,1],lwd=2,col=2)\nlines(desastres[,1],out.mu[,3],lty=2,col=2)\nlines(desastres[,1],out.mu[,7],lty=2,col=2)\n\n\n#--- Ejemplo 7 ---\n#-Reading data-\nmilk<-read.table(\"http://allman.rhon.itam.mx/~lnieto/index_archivos/milk.txt\",header=TRUE)\nmilk$t<-1970:1982\nn<-nrow(milk)\nor<-order(milk$x)\nplot(milk$x[or],milk$y[or],type=\"l\")\ntext(milk$x[or],milk$y[or],labels=milk$t[or],cex=0.5,col=2)\nplot(milk$t,milk$y,type=\"l\")\nplot(milk$t,milk$x,type=\"l\")\n\n\n#-Defining data-\nm<-2\ndata<-list(\"n\"=n,\"m\"=m,\"y\"=milk$y,\"x\"=milk$x/max(milk$x),\"t\"=milk$t/max(milk$t))\ndata<-list(\"n\"=n,\"y\"=c(milk$y[1:(n-2)],NA,NA),\"x\"=milk$x/max(milk$x),\"t\"=milk$t/max(milk$t))\n\n#-Defining inits-\n#inits<-function(){list(beta=0,tau=1,yf1=rep(1,n))}\n#inits<-function(){list(beta=rep(0,5),tau=1,yf1=rep(1,n))}\n#inits<-function(){list(beta=rep(0,n+m),tau.y=1,tau.b=1,yf1=rep(0,n+m))}\n#inits<-function(){list(beta=rep(0,n+m),tau.y=1,yf1=rep(0,n+m))}\n#inits<-function(){list(beta=rep(0,n+m),tau.y=1,tau.b=1,yf1=rep(0,n+m),g=0)}\ninits<-function(){list(beta=rep(0,n),tau.y=1,tau.b=1,yf1=rep(0,n),g=1)}\n\n#-Selecting parameters to monitor-\n#parameters<-c(\"beta\",\"tau\",\"yf1\")\nparameters<-c(\"beta\",\"tau.y\",\"tau.b\",\"yf1\",\"g\")\n#parameters<-c(\"beta\",\"tau.y\",\"tau.b\",\"yf1\")\n\n#-Running code-\n#OpenBUGS\nej7a.sim<-bugs(data,inits,parameters,model.file=\"Ej7a.txt\",\n               n.iter=50000,n.chains=2,n.burnin=5000)\nej7b.sim<-bugs(data,inits,parameters,model.file=\"Ej7b.txt\",\n               n.iter=50000,n.chains=1,n.burnin=5000)\nej7c.sim<-bugs(data,inits,parameters,model.file=\"Ej7c.txt\",\n               n.iter=100000,n.chains=1,n.burnin=10000)\n#JAGS\nej7a.sim<-jags(data,inits,parameters,model.file=\"Ej7a.txt\",\n               n.iter=50000,n.chains=1,n.burnin=5000)\nej7b.sim<-jags(data,inits,parameters,model.file=\"Ej7b.txt\",\n               n.iter=50000,n.chains=1,n.burnin=5000)\nej7c.sim<-jags(data,inits,parameters,model.file=\"Ej7c.txt\",\n               n.iter=50000,n.chains=1,n.burnin=5000)\n\n#-Monitoring chain-\n\n#Traza de la cadena\ntraceplot(ej6.sim)\n\n#Cadena\n\n#OpenBUGS\nout<-ej7c.sim$sims.list\n\n#JAGS\nout<-ej7a.sim$BUGSoutput$sims.list\n\nz<-out$tau\npar(mfrow=c(2,2))\nplot(z,type=\"l\")\nplot(cumsum(z)/(1:length(z)),type=\"l\")\nhist(z,freq=FALSE)\nacf(z)\n\n#Resumen (estimadores)\n#OpenBUGS\nout.sum<-ej7c.sim$summary\n\n#JAGS\nout.sum<-ej7a.sim$BUGSoutput$summary\n\nprint(out.sum)\nhead(out.sum)\n\n#Probabilidades\nz<-out$beta[,1]\nprob(z)\n\n#DIC\nout.dic<-ej7c.sim$DIC\nout.dic<-ej7a.sim$BUGSoutput$DIC\nprint(out.dic)\n\n#Predictions\nout.yf<-out.sum[grep(\"yf1\",rownames(out.sum)),]\nymin<-min(milk$y,out.yf[,c(1,3,7)])\nymax<-max(milk$y,out.yf[,c(1,3,7)])\nxmin<-min(milk$t)\nxmax<-max(milk$t+m)\n\n#x vs. y\npar(mfrow=c(1,1))\nplot(milk$x,milk$y,type=\"p\",col=\"grey50\",ylim=c(ymin,ymax))\npoints(milk$x,out.yf[,1],col=2,pch=16,cex=0.5)\nsegments(milk$x,out.yf[,3],milk$x,out.yf[,7],col=2)\n\n#t vs y\npar(mfrow=c(1,1))\nplot(milk$t,milk$y,type=\"b\",col=\"grey80\",ylim=c(ymin,ymax),xlim=c(xmin,xmax))\nlines(milk$t,out.yf[1:n,1],col=2)\nlines(milk$t,out.yf[1:n,3],col=2,lty=2)\nlines(milk$t,out.yf[1:n,7],col=2,lty=2)\nlines(milk$t[n]:(milk$t[n]+m),out.yf[n:(n+m),1],col=4)\nlines(milk$t[n]:(milk$t[n]+m),out.yf[n:(n+m),3],col=4,lty=2)\nlines(milk$t[n]:(milk$t[n]+m),out.yf[n:(n+m),7],col=4,lty=2)\n\n#betas\nout.beta<-out.sum[grep(\"beta\",rownames(out.sum)),]\nymin<-min(out.beta[,c(1,3,7)])\nymax<-max(out.beta[,c(1,3,7)])\nplot(out.beta[,1],type=\"l\",ylim=c(ymin,ymax))\nlines(out.beta[,3],lty=2)\nlines(out.beta[,7],lty=2)\n\n\n#--- Ejemplo 8 ---\n#-Reading data-\nmercado<-read.table(\"http://allman.rhon.itam.mx/~lnieto/index_archivos/mercado.txt\",header=TRUE)\nn<-nrow(mercado)\n\npairs(mercado)\ncor(mercado)\n\n#-Defining data-\ndata<-list(\"n\"=n,\"y\"=mercado$SHARE,\"x1\"=mercado$PRICE,\"x2\"=mercado$OPROM,\"x3\"=mercado$CPROM)\n\n#-Defining inits-\ninits<-function(){list(alpha=0,beta=rep(0,3),tau=1,yf1=rep(1,n))}\n\n#-Selecting parameters to monitor-\nparameters<-c(\"alpha\",\"beta\",\"tau\",\"yf1\")\n\n#-Running code-\n#OpenBUGS\nej8a.sim<-bugs(data,inits,parameters,model.file=\"Ej8a.txt\",\n               n.iter=50000,n.chains=1,n.burnin=5000)\n#JAGS\nej8a.sim<-jags(data,inits,parameters,model.file=\"Ej8a.txt\",\n               n.iter=50000,n.chains=1,n.burnin=5000)\n\n#-Monitoring chain-\n\n#Cadena\n\n#OpenBUGS\nout<-ej8a.sim$sims.list\n\n#JAGS\nout<-ej8a.sim$BUGSoutput$sims.list\n\nz<-out$alpha\npar(mfrow=c(2,2))\nplot(z,type=\"l\")\nplot(cumsum(z)/(1:length(z)),type=\"l\")\nhist(z,freq=FALSE)\nacf(z)\n\n#Resumen (estimadores)\n#OpenBUGS\nout.sum<-ej8a.sim$summary\n\n#JAGS\nout.sum<-ej8a.sim$BUGSoutput$summary\n\nprint(out.sum)\nhead(out.sum)\n\n#Probabilidades\nz<-out$beta[,1]\nprob(z)\n\n#DIC\nout.dic<-ej8a.sim$DIC\n#out.dic<-ej8a.sim$BUGSoutput$DIC\nprint(out.dic)\n\n#Predictions\nout.yf<-out.sum[grep(\"yf1\",rownames(out.sum)),]\ny<-mercado$SHARE\nymin<-min(y,out.yf[,c(1,3,7)])\nymax<-max(y,out.yf[,c(1,3,7)])\n\n#x1 vs. y\nx<-mercado$PRICE\npar(mfrow=c(1,1))\nplot(x,y,type=\"p\",col=\"grey50\",ylim=c(ymin,ymax))\npoints(x,out.yf[,1],col=2,pch=16,cex=0.5)\nsegments(x,out.yf[,3],x,out.yf[,7],col=2)\n#x2 vs. y\nx<-mercado$OPROM\npar(mfrow=c(1,1))\nplot(x,y,type=\"p\",col=\"grey50\",ylim=c(ymin,ymax))\npoints(x,out.yf[,1],col=2,pch=16,cex=0.5)\nsegments(x,out.yf[,3],x,out.yf[,7],col=2)\n#x3 vs. y\nx<-mercado$CPROM\npar(mfrow=c(1,1))\nplot(x,y,type=\"p\",col=\"grey50\",ylim=c(ymin,ymax))\npoints(x,out.yf[,1],col=2,pch=16,cex=0.5)\nsegments(x,out.yf[,3],x,out.yf[,7],col=2)\n\n\n#--- Ejemplo 10 ---\n#-Reading data-\nreclama<-read.table(\"http://allman.rhon.itam.mx/~lnieto/index_archivos/reclama.txt\",header=TRUE)\nn<-nrow(reclama)\npar(mfrow=c(2,2))\nplot(reclama$r)\nplot(reclama$n,ylim=c(0,max(reclama$n)))\nplot(reclama$r/reclama$n)\n\n#-Defining data-\ndata<-list(\"n\"=n,\"y\"=reclama$r,\"ne\"=reclama$n)\n\n#-Defining inits-\ninits<-function(){list(p=0.5,yf1=rep(1,n))}\ninits<-function(){list(p=rep(0.5,n),yf1=rep(1,n))}\ninits<-function(){list(p=rep(0.5,n),a=1,b=1,yf1=rep(1,n))}\n\n#-Selecting parameters to monitor-\nparameters<-c(\"p\",\"yf1\")\nparameters<-c(\"p\",\"eta\",\"yf1\")\n\n#-Running code-\n#OpenBUGS\nej10a.sim<-bugs(data,inits,parameters,model.file=\"Ej10a.txt\",\n                n.iter=50000,n.chains=1,n.burnin=5000)\nej10b.sim<-bugs(data,inits,parameters,model.file=\"Ej10b.txt\",\n                n.iter=50000,n.chains=1,n.burnin=5000)\nej10c.sim<-bugs(data,inits,parameters,model.file=\"Ej10c.txt\",\n                n.iter=100000,n.chains=1,n.burnin=10000)\n\n#JAGS\nej10a.sim<-jags(data,inits,parameters,model.file=\"Ej10a.txt\",\n                n.iter=50000,n.chains=1,n.burnin=5000)\nej10b.sim<-jags(data,inits,parameters,model.file=\"Ej10b.txt\",\n                n.iter=50000,n.chains=1,n.burnin=5000)\nej10c.sim<-jags(data,inits,parameters,model.file=\"Ej10c.txt\",\n                n.iter=100000,n.chains=1,n.burnin=10000)\n\n#-Monitoring chain-\n\n#Traza de la cadena\ntraceplot(ej10.sim)\n\n#Cadena\n\n#OpenBUGS\nouta<-ej10a.sim$sims.list\noutb<-ej10b.sim$sims.list\noutc<-ej10c.sim$sims.list\n\n#JAGS\nouta<-ej10a.sim$BUGSoutput$sims.list\noutb<-ej10b.sim$BUGSoutput$sims.list\noutc<-ej10c.sim$BUGSoutput$sims.list\n\nz<-outc$p[,9]\npar(mfrow=c(2,2))\nplot(z,type=\"l\")\nplot(cumsum(z)/(1:length(z)),type=\"l\")\nhist(z,freq=FALSE)\nacf(z)\n\n#Resumen (estimadores)\n#OpenBUGS\nouta.sum<-ej10a.sim$summary\noutb.sum<-ej10b.sim$summary\noutc.sum<-ej10c.sim$summary\n\n#JAGS\nouta.sum<-ej10a.sim$BUGSoutput$summary\noutb.sum<-ej10b.sim$BUGSoutput$summary\noutc.sum<-ej10c.sim$BUGSoutput$summary\n\nprint(outa.sum)\nhead(outa.sum)\n\n#Probabilidades\nz<-out$beta[,1]\nprob(z)\n\n#DIC\n#OpenBUGS\nouta.dic<-ej10a.sim$DIC\noutb.dic<-ej10b.sim$DIC\noutc.dic<-ej10c.sim$DIC\n\n#JAGS\nouta.dic<-ej10a.sim$BUGSoutput$DIC\noutb.dic<-ej10b.sim$BUGSoutput$DIC\noutc.dic<-ej10c.sim$BUGSoutput$DIC\n\nprint(outa.dic)\nprint(outb.dic)\nprint(outc.dic)\n\n#Estimaciones\nouta.p<-outa.sum[grep(\"p\",rownames(outa.sum)),]\noutb.p<-outb.sum[grep(\"p\",rownames(outb.sum)),]\noutc.p<-outc.sum[grep(\"p\",rownames(outc.sum)),]\noutc.eta<-outc.sum[grep(\"eta\",rownames(outc.sum)),]\n\n#x vs. y\nxmin<-0\nxmax<-12\nymin<-0\nymax<-1\npar(mfrow=c(1,1))\nplot(reclama$r/reclama$n,type=\"p\",col=\"grey50\",xlim=c(xmin,xmax),ylim=c(ymin,ymax))\n#\nout.p<-outb.p\npoints(out.p[,1],col=2,pch=16,cex=0.5)\nsegments(1:10,out.p[,3],1:10,out.p[,7],col=2)\n#\nout.p<-outc.p\npoints((1:10)+0.2,out.p[,1],col=4,pch=16,cex=0.5)\nsegments((1:10)+0.2,out.p[,3],(1:10)+0.2,out.p[,7],col=4)\n#\nout.p<-outa.p\npoints(xmax-0.2,out.p[1],col=3,pch=16,cex=0.5)\nsegments(xmax-0.2,out.p[3],xmax-0.2,out.p[7],col=3)\n#\nout.p<-outc.eta\npoints(xmax,out.p[1],col=4,pch=16,cex=0.5)\nsegments(xmax,out.p[3],xmax,out.p[7],col=4)",
    "created" : 1474896852706.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2571345172",
    "id" : "F97C723A",
    "lastKnownWriteTime" : 1474397150,
    "last_content_update" : 1474397150,
    "path" : "E:/itam/2016 Verano/glm/ClaseRA1.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}